
import CodeBlock from '@theme/CodeBlock';

import customField from '@site/src/libs/customField';

import AutomatedInstall from './_common/_automated-install.mdx';
import AutomatedUninstall from './_common/_automated-uninstall.mdx';
import ManualInstall from './_common/_manual-install.mdx';
import ManualInstallWindows from './_common/_manual-install-windows.mdx';
import ManualInstallInfo from './_common/_manual-info.mdx';

{/* ------------------------------------------------------------------------ */}

<AutomatedInstall label={ props.label } isWindows={ props.isWindows }/>


<details>
<summary>Folder hierarchy</summary>

After install, the package creates a folder hierarchy like the following
(only the first two depth levels are shown):

<CodeBlock language="console"> {
`C:\> tree /f %USERPROFILE%\\AppData\\Roaming\\xPacks\\@xpack-dev-tools\\openocd\\${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }\\.content
Folder PATH listing
Volume serial number is B02D-925C
C:\\USERS\\ILG\\APPDATA\\ROAMING\\XPACKS\\@XPACK-DEV-TOOLS\\OPENOCD\\0.12.0-3.1\\.CONTENT
│   README.md
├───bin
│       libftdi1.dll
│       libusb-1.0.dll
│       openocd.exe
├───distro-info
│   └───licenses
└───openocd
    ├───angie
    ├───contrib
    ├───OpenULINK
    └───scripts`
}</CodeBlock>

No other files are installed in any system folders or other locations.

</details>

<AutomatedUninstall isWindows={ props.isWindows }/>

### Quick test

To check if the { customField('appName') } installed by **xpm** starts properly, use something like:

<CodeBlock language="console"> {
`C:\\> %USERPROFILE%\\AppData\\Roaming\\xPacks\\@xpack-dev-tools\\openocd\\${ customField('upstreamVersion') }-${ customField('xpackSubversion') }.${ customField('npmSubversion') }\\.content\\bin\\openocd.exe --version
${ customField('upstreamVersion') }`
}</CodeBlock>

<ManualInstall/>

<ManualInstallWindows/>

<ManualInstallInfo/>

### Quick test

To check if the { customField('appName') } installed manually starts properly, use something like:

<CodeBlock language="console"> {
`C:\\> %USERPROFILE%\\AppData\\Roaming\\xPacks\\openocd\\xpack-openocd-${ customField('upstreamVersion') }-${ customField('xpackSubversion') }\\bin\\openocd.exe --version
${ customField('upstreamVersion') }`
}</CodeBlock>


## Drivers

As usual on Windows, mastering drivers is a challenge and OpenOCD is no
exceptions, so don't be surprised to encounter many incompatible drivers
for various JTAG probes.

### Zadig

The OpenOCD distribution includes some libusb
drivers, and recommends to run the [`zadig.exe`](https://zadig.akeo.ie) tool to activate them.

For example
[ARM-USB-OCD](https://www.olimex.com/Products/ARM/JTAG/) from
[Olimex](https://www.olimex.com/), after installing the vendor drivers,
asks to install Zadig and convert the vendor drivers to WinUSB drivers.

:::caution

Although converting the vendor drivers
to WinUSB drivers will make OpenOCD happy, please be aware that other
tools using the original drivers will no longer work while Zadig is
active, and to make them work you need to uninstall the Zadig driver
for the device and reinstall the vendor driver (see
[Zadig FAQ](https://github.com/pbatard/libwdi/wiki/FAQ#Help_Zadig_replaced_the_driver_for_the_wrong_device_How_do_I_restore_it)).
Our
recommendation is to use Zadig only as a last resort solution, and, when
possible, prefer the manufacturer drivers.

:::

### ST-LINK

One example of compatible drivers are the ST-LINK USB drivers, from ST,
available as part number
[STSW-LINK009](https://www.st.com/web/en/catalog/tools/FM147/SC1887/PF260219).
Download the latest `stsw-link009.zip` archive, extract its content into a separate
folder, and run the `dpinst_amd64.exe` (or `dpinst_x86.exe`) with
administrative privileges.

As for most Windows drivers, to complete the installation, a restart
usually helps.

Connect the ST-LINK or the DISCOVERY board and check in **Control Panel** 
→ **System** → **Device Manager** if the JTAG is operational.

![ST-LINK Windows device](/img/windows-devices-stlink.png)

For other probes follow the manufacturer instructions.

:::note

All Windows tests were performed on Windows 11.
If, for any
reasons, you still need to use older versions, especially the venerable Windows XP,
some differences may be observed in the USB subsystem; to stay on the
safe side, try to always use original manufacturer drivers.

:::

